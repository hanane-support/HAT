<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹í›… ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ | Vultr</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* í°íŠ¸ ë° ìŠ¤í¬ë¡¤ë°” */
        body { font-family: 'Inter', sans-serif; }
        .log-container::-webkit-scrollbar { width: 8px; }
        .log-container::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 10px; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-button.active { 
            background-color: #1f2937; /* Gray-800 */
            color: #a7f3d0; /* Lime-200 */
            border-left-color: #4ade80 !important; /* Lime-400 */
        }

        /* ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
        .main-grid { grid-template-columns: 250px 1fr; }
        @media (max-width: 768px) {
            .main-grid { grid-template-columns: 1fr; }
            #sidebar { display: none !important; }
            #mobile-nav { display: block !important; }
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">

    <!-- ëª¨ë°”ì¼ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div id="mobile-nav" class="md:hidden p-4 bg-gray-900 border-b border-gray-700 hidden">
        <select id="mobile-tab-select" class="w-full p-2 bg-gray-800 text-white rounded border border-gray-700">
            <option value="dashboard">ğŸ”” ëŒ€ì‹œë³´ë“œ</option>
            <option value="domain">ğŸŒ ë„ë©”ì¸ ì—°ë™</option>
            <option value="security">ğŸ”’ ë³´ì•ˆ</option>
        </select>
    </div>

    <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ: 2ì—´ ê·¸ë¦¬ë“œ (Sidebar + Content) -->
    <div class="main-grid min-h-screen">
        
        <!-- ì™¼ìª½ ì„¸ë¡œ íƒ­ ë©”ë‰´ (Sidebar) -->
        <aside id="sidebar" class="bg-gray-900 border-r border-gray-800 p-4 sticky top-0 h-screen">
            <h1 class="text-xl font-bold mb-6 text-sky-400">Vultr Webhook ì„¤ì •</h1>
            <nav class="space-y-2">
                <button class="tab-button active w-full text-left p-3 rounded-r-lg border-l-4 border-l-lime-400 transition duration-150 text-gray-300 hover:bg-gray-800" data-tab="dashboard">
                    ğŸ”” ì›¹í›… ë¦¬ìŠ¤ë„ˆ ëŒ€ì‹œë³´ë“œ
                </button>
                <button class="tab-button w-full text-left p-3 rounded-r-lg border-l-4 border-l-gray-800 transition duration-150 text-gray-300 hover:bg-gray-800" data-tab="domain">
                    ğŸŒ ë„ë©”ì¸ ì—°ë™
                </button>
                <button class="tab-button w-full text-left p-3 rounded-r-lg border-l-4 border-l-gray-800 transition duration-150 text-gray-300 hover:bg-gray-800" data-tab="security">
                    ğŸ”’ ë³´ì•ˆ
                </button>
            </nav>
            <div class="mt-8 pt-4 border-t border-gray-700 text-xs text-gray-500">
                <p>Status: <span id="deployment-status" class="text-red-500 font-semibold">Connecting...</span></p>
                <p>Last Saved: <span id="last-saved-time">N/A</span></p>
            </div>
        </aside>

        <!-- ì˜¤ë¥¸ìª½ ì½˜í…ì¸  ì˜ì—­ -->
        <main class="p-4 md:p-8 relative">
            
            <header class="mb-6 pb-3 border-b border-gray-700 flex justify-between items-center">
                <h2 id="page-title" class="text-3xl font-extrabold text-lime-400">ğŸ”” ì›¹í›… ë¦¬ìŠ¤ë„ˆ ëŒ€ì‹œë³´ë“œ</h2>
                <button id="save-settings-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                    ì„¤ì • ì €ì¥
                </button>
            </header>


            <!-- 1. ëŒ€ì‹œë³´ë“œ (ê¸°ë³¸ í™œì„±) -->
            <div id="dashboard" class="tab-content active space-y-6">
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 shadow-2xl">
                    <h3 class="text-xl font-bold mb-4 text-sky-300">ì‹¤ì‹œê°„ ì›¹í›… ìˆ˜ì‹  ë¡œê·¸</h3>
                    <!-- ì›¹í›… URL ì•ˆë‚´ -->
                    <div class="p-3 mb-4 bg-gray-800 border border-gray-700 rounded-lg">
                        <p class="text-sm text-gray-400">
                            ì›¹í›… URL (ë„ë©”ì¸ ì—°ë™ í›„): 
                            <code id="webhook-url-display" class="bg-gray-900 text-yellow-400 p-1 rounded">http://[SERVER_IP]:8000/webhook</code>
                            <button onclick="copyToClipboard('http://[SERVER_IP]:8000/webhook')" class="ml-2 text-xs text-sky-400 hover:text-sky-300">
                                [ë³µì‚¬]
                            </button>
                        </p>
                    </div>

                    <div id="log-list" class="log-container space-y-3 p-4 bg-gray-800 border border-gray-700 rounded-lg h-[60vh] overflow-y-auto">
                        <p class="text-gray-500 text-center py-10">ë¡œê·¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>

            <!-- 2. ë„ë©”ì¸ ì—°ë™ íƒ­ -->
            <div id="domain" class="tab-content space-y-6 hidden">
                <h3 class="text-2xl font-bold mb-4 text-yellow-400">ğŸŒ ë„ë©”ì¸ ì—°ë™ ì„¤ì •</h3>
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 shadow-2xl space-y-4">
                    <p class="text-gray-400">
                        Vultr ì„œë²„ IPë¡œ ì—°ê²°ëœ ë„ë©”ì¸ì„ ì…ë ¥í•˜ê³  ì—°ë™í•˜ì„¸ìš”. Caddyë¥¼ í†µí•´ HTTPS ì¸ì¦ì„œê°€ ìë™ ë°œê¸‰ë©ë‹ˆë‹¤.
                    </p>
                    <div class="flex flex-col space-y-2">
                        <label for="domain-input" class="text-lime-400 font-semibold">ë„ë©”ì¸ ì…ë ¥ (ì˜ˆ: webhook.mytrading.com)</label>
                        <input type="text" id="domain-input" placeholder="ë„ë©”ì¸ ì£¼ì†Œ" class="p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:ring-lime-500 focus:border-lime-500">
                    </div>
                    <button id="link-domain-btn" class="w-full bg-lime-600 hover:bg-lime-700 text-black font-bold py-3 px-4 rounded-lg transition duration-150">
                        ë„ë©”ì¸ ì—°ë™ ë° HTTPS ì ìš©
                    </button>
                    <div id="domain-status-message" class="mt-4 p-3 rounded-lg text-sm hidden"></div>
                </div>
            </div>

            <!-- 3. ë³´ì•ˆ íƒ­ -->
            <div id="security" class="tab-content space-y-6 hidden">
                <h3 class="text-2xl font-bold mb-4 text-red-400">ğŸ”’ ì›¹í›… ë³´ì•ˆ ì„¤ì • (Caddy ë°©í™”ë²½)</h3>
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-800 shadow-2xl space-y-4">
                    <p class="text-gray-400">
                        **ë„ë©”ì¸ ì—°ë™ í›„**ì—ë§Œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤. TradingView ê³µì‹ IPì™€ í˜„ì¬ ì ‘ì† ì¤‘ì¸ ë¡œì»¬ IPë§Œ í—ˆìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
                    </p>
                    <div class="flex flex-col space-y-2">
                        <label for="local-ip-input" class="text-sky-400 font-semibold">ë‚´ ë¡œì»¬ IP (ê´€ë¦¬ì ì ‘ê·¼ í—ˆìš©)</label>
                        <input type="text" id="local-ip-input" placeholder="ìë™ ê°ì§€ ì¤‘..." class="p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:ring-sky-500 focus:border-sky-500">
                    </div>
                    <button id="apply-security-btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150" disabled>
                        ë³´ì•ˆ (IP ì œí•œ) ì ìš©í•˜ê¸°
                    </button>
                    <div id="security-status-message" class="mt-4 p-3 rounded-lg text-sm hidden"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-sm border border-gray-700">
            <h4 id="modal-title" class="text-xl font-bold mb-4 text-yellow-400">ì•Œë¦¼</h4>
            <p id="modal-message" class="text-gray-300 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-ok-btn" class="bg-sky-600 hover:bg-sky-700 text-white py-2 px-4 rounded-lg">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ìƒíƒœ ë³€ìˆ˜
        let settings_status = {}; 
        let localIP = "";

        // UI ìš”ì†Œ
        const logList = document.getElementById('log-list');
        const saveBtn = document.getElementById('save-settings-btn');
        const linkDomainBtn = document.getElementById('link-domain-btn');
        const applySecurityBtn = document.getElementById('apply-security-btn');
        const domainInput = document.getElementById('domain-input');
        const localIpInput = document.getElementById('local-ip-input');
        const domainStatusMsg = document.getElementById('domain-status-message');
        const securityStatusMsg = document.getElementById('security-status-message');
        const deploymentStatusSpan = document.getElementById('deployment-status');
        const lastSavedTimeSpan = document.getElementById('last-saved-time');
        const pageTitle = document.getElementById('page-title');
        const webhookUrlDisplay = document.getElementById('webhook-url-display');
        
        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

        // ì»¤ìŠ¤í…€ ì•Œë¦¼ (alert ëŒ€ì²´)
        function showModal(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
            document.getElementById('modal-ok-btn').onclick = () => {
                document.getElementById('modal').classList.add('hidden');
                document.getElementById('modal').classList.remove('flex');
            };
        }

        // í…ìŠ¤íŠ¸ í´ë¦½ë³´ë“œ ë³µì‚¬
        window.copyToClipboard = function(text) {
            // ë„ë©”ì¸ ì—°ë™ ì „ì—ëŠ” IP ê¸°ë°˜ URLì„ ë³µì‚¬
            if (!settings_status.domain_linked && text.includes("[YOUR_DOMAIN]")) {
                text = webhookUrlDisplay.textContent;
            }
            
            const tempInput = document.createElement('input');
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            showModal('ë³µì‚¬ ì™„ë£Œ', 'ì›¹í›… URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateStatusMessage(element, message, type) {
            element.textContent = message;
            element.className = 'mt-4 p-3 rounded-lg text-sm';
            element.classList.remove('hidden');
            if (type === 'success') {
                element.classList.add('bg-green-900', 'text-lime-400');
            } else if (type === 'error') {
                element.classList.add('bg-red-900', 'text-red-400');
            } else { // info
                element.classList.add('bg-gray-700', 'text-gray-300');
            }
        }
        
        // UI ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateUIState() {
            const domain = settings_status.domain_name || "";
            domainInput.value = domain;
            localIpInput.value = localIP;
            
            const isDomainLinked = settings_status.domain_linked;
            const isSecurityApplied = settings_status.security_applied;

            // ì›¹í›… URL ì—…ë°ì´íŠ¸
            if (isDomainLinked) {
                webhookUrlDisplay.textContent = `https://${domain}/webhook`;
                // í´ë¦½ë³´ë“œ ë³µì‚¬ ë²„íŠ¼ì˜ onclick ì†ì„±ë„ ì—…ë°ì´íŠ¸ í•„ìš”
                const copyButton = document.querySelector('#webhook-url-display + button');
                copyButton.setAttribute('onclick', `copyToClipboard('https://${domain}/webhook')`);
            } else {
                 // ì„œë²„ IPë¥¼ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. (Vultr IPë¡œ ëŒ€ì²´í•´ì•¼ í•¨)
                 webhookUrlDisplay.textContent = document.URL.replace("/admin", "/webhook").replace(":8000", domain ? "" : ":8000");
                 // ì„ì‹œ URL ë³µì‚¬ë¥¼ ìœ„í•œ ì²˜ë¦¬ (ì„œë²„ IPë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì€ ë³µì¡í•˜ë¯€ë¡œ, URLì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ë„ë¡ ì„¤ì •)
                 const currentUrl = document.URL.split("/admin")[0] + "/webhook";
                 const copyButton = document.querySelector('#webhook-url-display + button');
                 copyButton.setAttribute('onclick', `copyToClipboard('${currentUrl}')`);
            }


            // ë³´ì•ˆ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            applySecurityBtn.disabled = !isDomainLinked || isSecurityApplied;
            
            applySecurityBtn.classList.remove('bg-red-600', 'hover:bg-red-700', 'bg-gray-600');
            if (isSecurityApplied) {
                applySecurityBtn.classList.add('bg-gray-600', 'hover:bg-gray-600');
                applySecurityBtn.textContent = "ë³´ì•ˆ ì ìš©ë¨";
            } else if (isDomainLinked) {
                applySecurityBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                applySecurityBtn.textContent = "ë³´ì•ˆ ì ìš©í•˜ê¸°";
            } else {
                applySecurityBtn.classList.add('bg-gray-600');
                applySecurityBtn.textContent = "ë„ë©”ì¸ ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤";
            }

            // ì„œë²„ ìƒíƒœ í‘œì‹œ
            deploymentStatusSpan.textContent = isDomainLinked ? (isSecurityApplied ? 'Secure' : 'Linked') : 'Not Configured';
            deploymentStatusSpan.className = isSecurityApplied ? 'text-green-500 font-semibold' : (isDomainLinked ? 'text-yellow-400 font-semibold' : 'text-red-500 font-semibold');

            // ë§ˆì§€ë§‰ ì €ì¥ ì‹œê°„
            lastSavedTimeSpan.textContent = settings_status.last_saved_time || 'N/A';
        }

        // --- ë°ì´í„° Fetch ë° ë Œë”ë§ ---

        // ì›¹í›… ë¡œê·¸ Fetch
        async function fetchWebhookData() {
            try {
                const response = await fetch('/data');
                const data = await response.json();
                renderLogList(data);
            } catch (error) {
                console.error('ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                logList.innerHTML = '<p class="text-red-500 text-center py-10">ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„(Gunicorn) ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
            }
        }

        function renderLogList(data) {
            if (data.length === 0) {
                logList.innerHTML = '<p class="text-gray-500 text-center py-10">ì›¹í›… ë©”ì‹œì§€ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</p>';
                return;
            }

            const newHTML = data.map(item => {
                const messageHtml = item.message.split('\n').map(line => 
                    `<span class="text-lime-400">${line}</span>`
                ).join('<br>');
                
                return `
                    <div class="p-3 border-b border-gray-700 hover:bg-gray-800 transition duration-150 rounded-lg">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-start">
                            <div class="text-sm font-semibold text-sky-400 mb-1 md:mb-0">
                                <span class="text-gray-500">[</span>${item.timestamp}<span class="text-gray-500">]</span>
                            </div>
                            <pre class="text-white text-sm whitespace-pre-wrap break-words mt-1 md:mt-0 max-w-full overflow-hidden">
                                ${messageHtml}
                            </pre>
                        </div>
                    </div>
                `;
            }).join('');
            logList.innerHTML = newHTML;
        }

        // ì„œë²„ ìƒíƒœ Fetch (ê°€ì¥ ì¤‘ìš”)
        async function fetchServerStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                settings_status = status;
                updateUIState();
            } catch (error) {
                console.error('ì„œë²„ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }

        // ë¡œì»¬ IP ìë™ ê°ì§€ (ë¹„ë™ê¸°)
        async function fetchLocalIP() {
            try {
                // ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì˜ Public IPë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                localIP = data.ip;
                localIpInput.value = localIP;
            } catch (error) {
                console.warn('ë¡œì»¬ IP ìë™ ê°ì§€ ì‹¤íŒ¨:', error);
                localIpInput.placeholder = "ë¡œì»¬ IP ìë™ ê°ì§€ ì‹¤íŒ¨, ìˆ˜ë™ ì…ë ¥ í•„ìš”";
            }
        }

        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---

        // íƒ­ ë³€ê²½
        function changeTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-l-lime-400');
                btn.classList.add('border-l-gray-800');
                if (btn.dataset.tab === tabId) {
                    btn.classList.add('active', 'border-l-lime-400');
                    btn.classList.remove('border-l-gray-800');
                    pageTitle.textContent = btn.textContent;
                }
            });
            
            document.getElementById('mobile-tab-select').value = tabId;
        }

        // ë„ë©”ì¸ ì—°ë™ ë²„íŠ¼ í´ë¦­
        linkDomainBtn.addEventListener('click', async () => {
            const domain = domainInput.value.trim();
            if (!domain) {
                return showModal('ê²½ê³ ', 'ë„ë©”ì¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
            }

            updateStatusMessage(domainStatusMsg, 'ë„ë©”ì¸ ì—°ë™ ë° Caddy ì¬ì‹œì‘ ì¤‘...', 'info');
            try {
                const response = await fetch('/api/link_domain', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain: domain })
                });
                const result = await response.json();
                
                if (response.ok) {
                    updateStatusMessage(domainStatusMsg, result.message, 'success');
                    // Caddy ì¬ì‹œì‘ í›„ HTTPSê°€ í™œì„±í™”ë˜ë¯€ë¡œ, ì ì‹œ í›„ URLì„ HTTPSë¡œ ì•ˆë‚´
                    setTimeout(() => showModal('ì„±ê³µ ì•Œë¦¼', `ë„ë©”ì¸ ì—°ë™ ì„±ê³µ! ì´ì œë¶€í„° **https://${domain}/admin** ìœ¼ë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”.`), 1000);
                    await fetchServerStatus(); // ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                } else {
                    updateStatusMessage(domainStatusMsg, `ì˜¤ë¥˜: ${result.detail}`, 'error');
                }
            } catch (error) {
                console.error('ë„ë©”ì¸ ì—°ë™ ì˜¤ë¥˜:', error);
                updateStatusMessage(domainStatusMsg, `ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        });

        // ë³´ì•ˆ ì ìš© ë²„íŠ¼ í´ë¦­
        applySecurityBtn.addEventListener('click', async () => {
            if (!settings_status.domain_linked) {
                return showModal('ê²½ê³ ', 'ë„ë©”ì¸ ì—°ë™ì´ ë¨¼ì € í•„ìš”í•©ë‹ˆë‹¤.');
            }
            const localIp = localIpInput.value.trim();
            if (!localIp) {
                 return showModal('ê²½ê³ ', 'ë¡œì»¬ IPë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ìë™ ê°ì§€ë˜ë„ë¡ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.');
            }

            updateStatusMessage(securityStatusMsg, 'ë³´ì•ˆ Caddyfile ì‘ì„± ë° Caddy ì¬ì‹œì‘ ì¤‘...', 'info');
            try {
                const response = await fetch('/api/apply_security', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ local_ip: localIp })
                });
                const result = await response.json();
                
                if (response.ok) {
                    updateStatusMessage(securityStatusMsg, result.message, 'success');
                    await fetchServerStatus(); // ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                } else {
                    updateStatusMessage(securityStatusMsg, `ì˜¤ë¥˜: ${result.detail}`, 'error');
                }
            } catch (error) {
                console.error('ë³´ì•ˆ ì ìš© ì˜¤ë¥˜:', error);
                updateStatusMessage(securityStatusMsg, `ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        });
        
        // ì„¤ì • ì €ì¥ ë²„íŠ¼ í´ë¦­ (í˜„ì¬ëŠ” ìƒíƒœ ì—…ë°ì´íŠ¸ë§Œ)
        saveBtn.addEventListener('click', async () => {
             try {
                const response = await fetch('/api/save_settings', { method: 'POST' });
                const result = await response.json();
                showModal('ì„¤ì • ì €ì¥', result.message);
                await fetchServerStatus();
            } catch (error) {
                showModal('ì €ì¥ ì˜¤ë¥˜', 'ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });


        // --- ì´ˆê¸°í™” ---
        
        document.addEventListener('DOMContentLoaded', () => {
            // íƒ­ í•¸ë“¤ëŸ¬ ë“±ë¡
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => changeTab(button.dataset.tab));
            });
            document.getElementById('mobile-tab-select').addEventListener('change', (e) => {
                changeTab(e.target.value);
            });
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ ë° íƒ€ì´ë¨¸ ì‹œì‘
            fetchServerStatus();
            fetchLocalIP();
            setInterval(fetchWebhookData, 5000); // 5ì´ˆë§ˆë‹¤ ë¡œê·¸ ì—…ë°ì´íŠ¸
            setInterval(fetchServerStatus, 10000); // 10ì´ˆë§ˆë‹¤ ì„œë²„ ìƒíƒœ ì—…ë°ì´íŠ¸
            
            // ì´ˆê¸° íƒ­ ì„¤ì •
            changeTab('dashboard');
        });
    </script>
</body>
</html>
